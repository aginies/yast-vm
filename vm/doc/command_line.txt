
    Yast Xen Module - Command Line Interface
===============================================

$Id:$

This document describes usage of the command line interface in the Yast Xen
module.


1. Using Command Line Mode in Yast
==================================

The general syntax for invoking yast in command line is
'yast <module_name> <command> [option1, option2,...]'

module_name - name of the yast module
command - invoked command

To get a list of all options use 'yast <module_name> help'



2. The Xen Module - Command Line Options
========================================

Command line mode support in the Xen module is currently very limited.

The only supported command is 'install' with mandatory 'autoyast' parameter.
The command will create a new Xen virtual machine (VM) and starts an
installation inside it. 

Example:

# yast2 xen install autoyast=/var/lib/autoinstall/repository/autoyast.xml display verbose


Description of the example:

Option 'autoyast' contains location of the autoyast profile which will be used
for configuring the VM and for installing a system inside the VM.

Option 'display' is optional, if it's used the VM console will be displayed in
a window during installation.

Option 'verbose' is optional, yast module prints
more information during installation.


If there is no X Server available then use command:

# yast xen install autoyast=/var/lib/autoinstall/repository/autoyast.xml verbose



3. How to Create an Autoyast XML Profile
========================================

The autoyast profile used for VM installation must include two parts:

  1. configuration of the VM itself (memory and CPU configuration, location of
     virtual disks...)
  2. configuration of the system which will be installed inside the VM


Use autoyast configuration module to create the profile ('Miscellaneous ->
Autoinstallation' in the Yast Control Center or use command 'yast2 autoyast').
Refer to the Manual for more information about Autoyast (on-line version:
http://www.novell.com/documentation)


3.1. Configuring the VM Options
-------------------------------

Use 'System -> Virtual Machine Management (Xen)', press 'Configure'.
Yast opens a proposal dialog for VM installation.

The most important option is location of the installation source used for
installation of the VM. Use 'Operating System Installation' link in the
proposal dialog if you want to change the proposed source.

Name of the virtual machine, MAC address of the virtual network card inside the
VM and the boot device can be left empty. In this case the options will be
generated at run-time:

 - unused 'vm<number>' name will be assigned to the VM
 - a random MAC address will be generated for each unconfigured network card 
 - boot device will be detected (all virtual disk will be scanned for kernel
   and initrd files)

The empty options allow to use the autoyast profile as a template for mass VM
installation (if a file-based virtual storage device is used a new disk image
will be created for each VM).

Required steps:

 - use 'VM Properties', to set the name of VM
 - use 'Network', select the proposed network card, press 'Edit', delete the
   MAC address
 - press 'Next', leave the option 'Partition Containing Boot Files' empty



3.2. Configuring the Installation Options
-----------------------------------------

3.2.1. Package Selection
------------------------

Note: It's important to have registered the same installation sources in the
configuration system as is used in the VM. Use "Installation source" module in
the Yast Control Center the current configuration.

Use 'Software -> Package Selection -> Configure' to select the required
packages.


3.2.2. Partitioning
-------------------

Assign a disk where the system will be installed. Use 'Hardware -> Partitioning
-> Configure', press 'Add Drive' and select a drive and set "Use available
free space only" option.

It's important to configure the same disk as is configured in the VM
configuration. The default value in VM is /dev/hda.


3.2.3. Enable Automatic Installation
------------------------------------

Use 'System -> General Options -> Configure' to disable the confirmation of the
installation.

Select 'Mouse = NONE' and deselect 'Confirm installation?' option.


3.2.4. Configure Root User Password
-----------------------------------

Use 'Security and Users -> User Management -> Configure', select 'root' user,
press 'Edit' and set the password (it's stored in encrypted form in the XML
profile).


3.2.5. Configure the Virtual Network Card Inside VM
---------------------------------------------------

The network card will use DHCP configuration mode, you need a DHCP server to be
present in the network.


3.2.6. Saving the Profile
-------------------------

When the configuration is finished you can use 'File -> Save As' in the main
menu to save the configuration to a XML file.



4. Example
==========

There is an example profile
/usr/share/doc/packages/yast2-vm/xen_autoyast_example.xml

You only need to change URL of the installation source (replace string
'ftp:://10.20.3.1/...') then the profile can be used with the commands in the
Section 2.

(Note: Password of root user is set to 'root' in the example profile.)


